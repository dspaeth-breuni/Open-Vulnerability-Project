package io.github.jeremylong.openvulnerability.client.nvd;
import org.apache.hc.core5.http.Header;
import org.apache.hc.core5.http.NameValuePair;
import org.apache.hc.core5.http.message.BasicHeader;
import org.apache.hc.core5.http.message.BasicNameValuePair;

import java.util.List;

public enum APIStrategy {
    API_KEY_HEADER {
        @Override
        public Header createHeader(String apiKey) {
            return new BasicHeader("apiKey", apiKey);
        }

        @Override
        public List<NameValuePair> createPageParams(int limit, int currentPage) {
            return List.of(
                    new BasicNameValuePair("resultsPerPage", Integer.toString(limit)),
                    new BasicNameValuePair("startIndex", Integer.toString(currentPage ))
            );
        }

        @Override
        public Class<? extends CveApiCommon> getResponseClass() {
            return CveApiJson20.class;
        }
    },
    BEARER_TOKEN_HEADER {
        @Override
        public Header createHeader(String apiKey) {
            return new BasicHeader("Authorization", "Bearer " + apiKey);
        }

        @Override
        public List<NameValuePair> createPageParams(int limit, int currentPage) {
            return List.of(
                    new BasicNameValuePair("limit", Integer.toString(Math.min(limit, 20))),
                    new BasicNameValuePair("page", Integer.toString(currentPage + 1))
            );
        }

        @Override
        public Class<? extends CveApiCommon> getResponseClass() {
            return CveApiJsonVulnCheck.class;
        }
    };

    public abstract Header createHeader(String apiKey);

    public abstract List<NameValuePair> createPageParams(int limit, int currentPage);

    public abstract Class<? extends CveApiCommon> getResponseClass();
}
